var FBPublication=FBPublication||{};FBPublication.search=function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=116)}({116:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.HighlighterPresenter=e.HighlighterModel=e.LocalSearchProvider=void 0;var r=n(117),o=i(r),s=n(118),a=i(s),l=n(120),u=i(l);e.LocalSearchProvider=u["default"],e.HighlighterModel=o["default"],e.HighlighterPresenter=a["default"]},117:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,e,n,i){var r,o,s,a,l,u,h,c="R"===t[1];c?(r=t[2]/10,o=t[3]/10,s=t[4]/1e3,a=t[5]/10):(r=t[1]/10,o=t[2]/10,s=t[3]/1e3,a=t[4]/10),l=n+(i-1),u=0===n?0:e[n-1]/10,h=e[l]/10-u,this.y=o,this.x=r+u-(c?h:0),this.width=h,this.height=a,this.angle=s,this.rotatePadding=u-(c?h:0)}function o(t,e){this.pageModel=t,this.searchCharactersLimit=e,this._data=null}Object.defineProperty(e,"__esModule",{value:!0});var s=n(31),a=i(s),l=window.FBPublication.build,u=l.fbUtils,h=l._;o.prototype.getQueryHighlights=function(t,e){var n=this;h.isNull(this._data)?this._loadHighlightIndex(function(i,r){i?e(i):(n._data=r,n._parseHighlightData(t,e))}):this._parseHighlightData(t,e)},o.prototype._loadHighlightIndex=function(t){u.loadXML([this.pageModel.getSearchInfoUrl()],function(e){t(null,e)},function(e){t(e)})},o.prototype._parseHighlightData=function(t,e){var n=[];try{var i,o,s,l,c;i=this._data.split("\n"),t=t.toLowerCase()||"",t=u.split(t,0);for(var f=1,d=i.length;f<d;f++){o=i[f],s=0;for(var p=0,g=t.length;p<g;p++){if(l=t[p],c=o.split(String.fromCharCode(2)),l.length<this.searchCharactersLimit){var v=h.isUndefined(i[f-1])?"":i[f-1].split(String.fromCharCode(2))[0],y=h.isUndefined(i[f])?"":i[f].split(String.fromCharCode(2))[0],m=h.isUndefined(i[f+1])?"":i[f+1].split(String.fromCharCode(2))[0],_=v+" "+y,x=y+" "+m,b=t[p-1]||"",w=t[p],C=t[p+1]||"",S=b+" "+w,L=w+" "+C,I=!1;""!==b&&a["default"].findIndexes(_,S)&&(I=!0),""!==C&&a["default"].findIndexes(x,L)&&(I=!0)}else I=!0;var F=a["default"].findIndexes(c[0],l);if(s=F?F[0]:-1,s!==-1&&I){var P=o.split(String.fromCharCode(4)),M=[],R=[];if(P.length>1){for(var z=0,O=P.length;z<O;z++)M[z]=P[z].split(String.fromCharCode(2)),z>0&&M[z].unshift(M[0][0]),R[z]=M[z][5].split(String.fromCharCode(3));for(var T=s,B=s+l.length,j=0,E=M.length;j<E;j++){var H;R[j].length<=T?(T-=R[j].length,B-=R[j].length):(B>R[j].length?(H=R[j].length,B-=R[j].length):(H=B,B=0),T>0&&(H-=T),n.push(new r(M[j],R[j],T,H)),T=0)}}else R="R"===c[1]?c[6].split(String.fromCharCode(3)):c[5].split(String.fromCharCode(3)),n.push(new r(c,R,s,l.length))}}}}catch(q){e(q)}e(null,n)},e["default"]=o},118:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t){this.model=t,this._cancelled=!1}Object.defineProperty(e,"__esModule",{value:!0});var o=n(119),s=i(o),a=window.FBPublication.build,l=a._;r.prototype.getSearchHighlightViews=function(t,e){var n=this;this.model.getQueryHighlights(t,function(t,i){n._cancelled||(t?e(t):(n.views=l.map(i,function(t){return new s["default"](this).init(t)}),e(null,l.map(n.views,function(t){return t.getViewDOMElement()}))))})},r.prototype.offset=function(t){l.each(this.views,function(e){e.offset(t)})},r.prototype.scale=function(t){l.each(this.views,function(e){e.scale(t)})},r.prototype.cancelAllRequests=function(){this._cancelled=!0},e["default"]=r},119:function(t,e,n){"use strict";function i(t){this.presenter=t}Object.defineProperty(e,"__esModule",{value:!0});var r=window.FBPublication.build,o=r.html5Lib,s=r._,a=r.el;i.prototype.init=function(t,e){var n={offsetFactor:0,scaleFactor:1};return s.extend(n,e),this.offsetFactor=n.offsetFactor,this.scaleFactor=n.scaleFactor,this.item=t,this.view=a.createElement("div",{"class":"highlight-element",styles:{position:"absolute"}}),this._place(),this},i.prototype.getViewDOMElement=function(){return this.view},i.prototype.offset=function(t){this.offsetFactor=t,this._place()},i.prototype.scale=function(t){this.scaleFactor=t,this._place()},i.prototype._place=function(){a.css(this.view,{top:this.item.y*this.scaleFactor+"px",left:(this.item.x+this.offsetFactor)*this.scaleFactor+"px",width:this.item.width*this.scaleFactor+"px",height:this.item.height*this.scaleFactor+"px"}),this.item.angle&&(o.origin(this.view,0,0),o.rotate(this.view,this.item.angle+"rad",0,0,1,!0))},e["default"]=i},120:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){this.normalized={},t=t||{},this.searchCharactersLimit=t.searchCharactersLimit,this.exactMatch=t.exactMatch,this.maxTextResultLength=t.maxTextResultLength||90,this.chunkSize=66,this.searchInterval=33,this.searchIndex=null,this.result=null,this.indexLoadStarted=!1,this._pageTable=e;var n=this;this.on("change:query",function(){n.set("result",null)})}Object.defineProperty(e,"__esModule",{value:!0});var o=n(121),s=i(o),a=n(31),l=i(a),u=window.FBPublication.build,h=u._,c=u.FBRouter,f=u.FBLocator,d=u.fbUtils;r.prototype=new s["default"],r.prototype.constructor=r,r.prototype.getResultsAsync=function(t,e,n){var i=this;if(h.isEmpty(this.query)||!this.isQueryValid())return[];if(!h.isNull(this.result))return void n(this.result.slice(t*e,t*e+e),!0);var r=function(){h.defer(function(){i._run_search(function(r){n(i.result.slice(t*e,t*e+e),r)})})};this.loadSearchIndex(function(){r()})},r.prototype.getResultsCountSync=function(){return h.isNull(this.result)?void 0:this.result.length},r.prototype._getBold=function(t,e){var n=l["default"].findIndexes(t,e);return n?t.substring(0,n[0])+"<b>"+t.substring(n[0],n[1]+1)+"</b>"+t.substring(n[1]+1,t.length):t},r.prototype.loadSearchIndex=function(t){function e(t,e){for(var n=[];t.length;)n.push(t.splice(0,e));return n}var n=this;return this.callback=t||function(){},this.isIndexLoaded()?void this.callback():void(this.indexLoadStarted||(this.indexLoadStarted=!0,d.loadJSON([c().translatePath("assets/common/search/searchtext.js")],function(t){n.searchIndex=e(t.pages.page,n.chunkSize),n.callback()})))},r.prototype._sendSearchEvent=h.debounce(function(t,e){f().get(f.API).trigger("search",{query:t,success:e.length>0,quantity:e.length})},2500),r.prototype.normalize=function(t,e){if(!this.normalized.hasOwnProperty(t)){var n=l["default"].toLowerCase(l["default"].normalize(e));this.normalized[t]=null!==e?n:null}return this.normalized[t]},r.prototype._run_search=function(t){function e(t){for(var e in t)if(h.has(t,e)){var o=t[e],l=o["#text"],c=n._searchFullCoincidence(s,l,o["@ID"],!0);h.isNull(c)||i.push(c),h.isNull(c)&&null!==l&&(n.exactMatch||(u>1?(c=n._searchPartiallyCoincidence(a,l,o["@ID"],u,s.length),h.isNull(c)||i.push(c)):1===u&&(c=n._searchFullCoincidence(a[0],l,o["@ID"],!1),h.isNull(c)||i.push(c))))}r++}var n=this,i=[],r=0,o=0,s=l["default"].toLowerCase(l["default"].normalize(this.query)),a=d.split(s,this.searchCharactersLimit),u=a.length;h.isUndefined(this.searchTimer)||clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function c(){r>0&&(n.result=i.sort(n._sortFunc.bind(n)),t(r===n.searchIndex.length)),r<n.searchIndex.length?(h.defer(e,n.searchIndex[o]),o++,n.searchTimer=setTimeout(c,n.searchInterval)):n._sendSearchEvent(s,i)},0)},r.prototype._buildSearchText=function(t,e,n){n=n||[];var i=e-this.maxTextResultLength/2;i=i<0?0:i;var r=l["default"].normalize(t.substr(i,parseInt(this.maxTextResultLength,10)+6));if(r="..."+r+"...",r=d.screening(r),n.length>0)for(var o=0;o<n.length;o++)r=this._getBold(r,n[o]);else r=this._getBold(r,this.query);return r},r.prototype._buildIndexes=function(t,e,n){for(var i=[],r=0;r<e;r++){for(var o=[],s=t[r],a=0,l=-2;l!==-1;)l>=0&&o.push(l),l=n.indexOf(s,a),a=l+this.searchCharactersLimit;o.length>0&&i.push(o)}return i},r.prototype._searchFullCoincidence=function(t,e,n,i){for(var r=-1,o=-1,a=this.normalize(n,e);(r=a.indexOf(t,r+1))>=0;)if(o=r,r!==-1&&(0===r||d.isSplitter(a.charAt(r-1)))&&(r+t.length===a.length||d.isSplitter(a.charAt(r+t.length))))return new s["default"].SearchResult(n,this._buildSearchText(e,r,[t]),i?0:1,r,r+t.length,i);return o>=0&&!this.exactMatch?new s["default"].SearchResult(n,this._buildSearchText(e,o,[t]),i?2:3,o,o+t.length,i):null},r.prototype._searchPartiallyCoincidence=function(t,e,n,i){var r=this.normalize(n,e),o=this._buildIndexes(t,i,r);if(null===o||0===o.length)return null;for(var a=0,l=new Array(o.length),u=0;u<o.length;u++)l[u]=o[u][0];for(var h=0;h<o.length-1;h++){var c=1e3,f=o[h],d=o[h+1];if(null===f||null===d)break;for(var p=f.length,g=d.length,v=0;v<p;v++)for(var y=0;y<g;y++){var m=f[v],_=d[y],x=_>m?1:2,b=_>m?_-m:m-_,w=b*x;w<c&&(l[h]=m,l[h+1]=_,c=w)}a+=c}for(var C=1e4,S=0,L=0;null!==l&&L<l.length;L++)C=Math.min(C,l[L]),S=Math.max(S,l[L]);return a+=1e3*(i-o.length),r=null,new s["default"].SearchResult(n,this._buildSearchText(e,C,t),a+4,C,S,(!1))},r.prototype._sortFunc=function(t,e){return t.relevance!==e.relevance?t.relevance-e.relevance:t.pageId-e.pageId},r.prototype.getMinimumQueryLength=function(){return this.searchCharactersLimit},r.prototype.isIndexLoaded=function(){return!h.isNull(this.searchIndex)},r.prototype.deleteIndex=function(){this.searchIndex=null,this.indexLoadStarted=!1},e["default"]=r},121:function(t,e,n){"use strict";function i(){this.query=null}Object.defineProperty(e,"__esModule",{value:!0});var r=window.FBPublication.build,o=r.Events;i.prototype=new o,i.prototype.constructor=i,i.prototype.getResultsSync=function(t,e){throw new Error("is an abstract method")},i.prototype.getResultsAsync=function(t,e,n){throw new Error("is an abstract method")},i.prototype.getResultsCountSync=function(){throw new Error("is an abstract method")},i.prototype.getResultsCountAsync=function(t){throw new Error("is an abstract method")},i.prototype.setQuery=function(t){this.set("query",t)},i.prototype.isQueryValid=function(){return!!this.query&&this.query.length>=this.getMinimumQueryLength()},i.prototype.getMinimumQueryLength=function(){return 1},i.prototype.isIndexLoaded=function(){return!1},i.SearchResult=function(t,e,n,i,r,o){this.pageId=t,this.text=e,this.relevance=n,this.startPos=i,this.stopPos=r,this.fullText=o},e["default"]=i},31:function(t,e,n){"use strict";function i(){}Object.defineProperty(e,"__esModule",{value:!0});var r=/[\u0300-\u036f]/g,o={"ı":"i","ё":"е"},s=new RegExp(Object.keys(o).join("|"),"gi");i.normalize=function(t){return String.prototype.normalize||console.error("String does'nt have normalize function"),t.normalize("NFKD")},i.toLowerCase=function(t){return t.toLowerCase().replace(r,"").replace(s,function(t){return o[t]})},i.findIndexes=function(t,e){for(var n=0,r=0,o=!1,s=0;s<t.length;s++)if(0!==i.toLowerCase(t.charAt(s)).length){if(o)break;i.toLowerCase(i.normalize(t.charAt(s)))===i.toLowerCase(i.normalize(e.charAt(r)))?r++:(n=s+1,r=0),r===e.length&&(o=!0)}return r===e.length?[n,s-1]:null},e["default"]=i}});